# Test -coverprofile flag

# -coverprofile writes a Go-compatible coverage profile file
gno test -coverprofile=coverage.out .

! stdout .+
stderr 'ok      \. 	\d+\.\d\ds	coverage: \d+\.\d+% of statements'
exists coverage.out

exec cat coverage.out
stdout 'mode: set'
stdout 'gno\.test/r/integ/coverprofile/cover\.gno:\d+\.\d+,\d+\.\d+ \d+ \d+'

# -coverprofile implicitly enables -cover
gno test -coverprofile=coverage2.out .

! stdout .+
stderr 'ok      \. 	\d+\.\d\ds	coverage: \d+\.\d+% of statements'
exists coverage2.out

-- cover.gno --
package coverprofile

func Add(a, b int) int {
	return a + b
}

func Abs(x int) int {
	if x < 0 {
		return -x
	}
	return x
}

-- cover_test.gno --
package coverprofile

import "testing"

func TestAdd(t *testing.T) {
	result := Add(2, 3)
	if result != 5 {
		t.Fatalf("expected 5, got %d", result)
	}
}

-- gnomod.toml --
module = 'gno.test/r/integ/coverprofile'
