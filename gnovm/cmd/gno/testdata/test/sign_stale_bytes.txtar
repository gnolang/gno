# Regression test for TypedValue.Sign() stale upper bytes bug.
#
# Converting int64 to int8 used to read all bytes in the N buffer even for small types,
# which could contain stale data from previous conversions, causing Sign() to return a wrong result.
# This made valid shift operations panic with "negative shift amount (uint8 1)" even though the value was positive.

gno test .

! stdout .+
stderr 'ok      \. 	\d+\.\d\ds'

-- stale_sign_filetest.gno --
package main

func main() {
	var x int64 = -255

	// Runtime conversion: int8(-255) truncates to int8(1).
	var y int8 = int8(x) // y == 1

	// Confirm y is indeed 1.
	println(y)

	// A clean int8(1) works fine (no prior int64 conversion).
	var clean int8 = 1
	println(1 << clean) // prints 2

	// Shifting by y must also work â€” y == clean == 1.
	println(1 << y) // prints 2
}

// Output:
// 1
// 2
// 2

-- gnomod.toml --
module = "gno.test/p/integ/sign_stale_bytes"
gno = "0.9"
