# Test --bench-profile flag writes JSONL file with valid bench events

gno test --bench-profile results.jsonl .

exists results.jsonl

# Verify JSON structure using jsonbench
jsonbench results.jsonl
cmp stdout expected.golden

-- gnomod.toml --
module = "gno.land/p/demo/benchprofile"
gno = "0.9"

-- foo.gno --
package benchprofile

-- foo_test.gno --
package benchprofile

import "testing"

func TestFoo(t *testing.T) {
	x := 1 + 2
	_ = x
}

-- expected.golden --
Package: gno.land/p/demo/benchprofile
Test: TestFoo
Opcodes:
  OpAdd: count=9 gas=18
  OpAssign: count=3 gas=79
  OpBinary1: count=4 gas=18
  OpBody: count=46 gas=43
  OpCall: count=19 gas=256
  OpCallNativeBody: count=7 gas=424
  OpCompositeLit: count=3 gas=50
  OpConvert: count=7 gas=16
  OpDefer: count=1 gas=64
  OpDefine: count=9 gas=111
  OpEql: count=2 gas=160
  OpEval: count=201 gas=29
  OpExec: count=4 gas=25
  OpFuncLit: count=1 gas=61
  OpFuncType: count=1 gas=81
  OpHalt: count=10 gas=1
  OpIfCond: count=13 gas=38
  OpLand: count=4 gas=24
  OpLeq: count=1 gas=19
  OpLss: count=3 gas=13
  OpNeq: count=1 gas=95
  OpPopBlock: count=20 gas=3
  OpPopFrameAndReset: count=1 gas=15
  OpPopResults: count=2 gas=1
  OpPrecall: count=26 gas=207
  OpQuo: count=1 gas=16
  OpRangeIter: count=2 gas=105
  OpRef: count=2 gas=125
  OpReturn: count=16 gas=38
  OpReturnAfterCopy: count=1 gas=38
  OpReturnCallDefers: count=2 gas=78
  OpReturnFromBlock: count=3 gas=36
  OpSelector: count=24 gas=32
  OpSlice: count=4 gas=103
  OpStructLit: count=3 gas=179
  OpSub: count=4 gas=6
  OpTypeSwitch: count=1 gas=171
  OpUnot: count=2 gas=6
  OpValueDecl: count=1 gas=113
  OpVoid: count=466 gas=1
Store:
  StoreGetBlockNode: count=8 size=0
  StoreGetObject: count=133 size=108087
HotSpots:
  foo_test.gno:6 TestFoo: count=2 gas=140
  foo_test.gno:7 TestFoo: count=2 gas=108
  itoa.gno:26 FormatInt: count=35 gas=1576
  itoa.gno:60 small: count=5 gas=138
  testing.gno:110 Failed: count=8 gas=256
  testing.gno:228 marshal: count=2 gas=140
  testing.gno:229 marshal: count=2 gas=140
  testing.gno:230 marshal: count=4 gas=128
  testing.gno:233 marshal: count=4 gas=128
  testing.gno:298 shouldRun: count=7 gas=346
  testing.gno:309 RunTest: count=12 gas=700
  testing.gno:315 RunTest: count=5 gas=220
  testing.gno:320 RunTest: count=15 gas=816
  testing.gno:326 RunTest: count=7 gas=693
  testing.gno:357 formatDur: count=15 gas=1077
  testing.gno:358 formatDur: count=9 gas=659
  testing.gno:359 formatDur: count=3 gas=167
  testing.gno:360 formatDur: count=15 gas=930
  testing.gno:375 tRunner: count=12 gas=745
  testing.gno:379 tRunner: count=7 gas=1094
  testing.gno:381 tRunner: count=5 gas=264
  testing.gno:382 -: count=9 gas=1155
  testing.gno:383 -: count=2 gas=200
  testing.gno:391 -: count=12 gas=1219
  testing.gno:392 -: count=9 gas=719
  testing.gno:394 -: count=4 gas=128
  testing.gno:406 tRunner: count=2 gas=67
