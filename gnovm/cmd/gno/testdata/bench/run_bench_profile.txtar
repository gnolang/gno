# Test gno run --bench-profile flag writes valid JSON profile

gno run --bench-profile profile.json main.gno

stdout 'World'
exists profile.json

# Verify profile contains expected OpStats using jsonbench
jsonbench profile.json
cmp stdout expected.golden

-- main.gno --
package main

func main() {
	for i := 0; i < 10; i++ {
		_ = i * 2
	}
	println("World")
}

-- expected.golden --
Opcodes:
  OpAssign: count=10 gas=79
  OpBody: count=3 gas=43
  OpCall: count=2 gas=256
  OpCallNativeBody: count=1 gas=424
  OpDefine: count=1 gas=111
  OpEval: count=75 gas=29
  OpExec: count=2 gas=25
  OpForLoop: count=21 gas=27
  OpFuncType: count=1 gas=81
  OpHalt: count=14 gas=1
  OpInc: count=10 gas=76
  OpLss: count=11 gas=13
  OpMul: count=10 gas=19
  OpPopBlock: count=13 gas=3
  OpPopResults: count=1 gas=1
  OpPrecall: count=2 gas=207
  OpReturn: count=1 gas=38
  OpReturnFromBlock: count=1 gas=36
  OpVoid: count=187 gas=1
Store:
  StoreGetObject: count=1 size=0
Native:
  NativePrint: count=1
HotSpots:
  main.gno:4 -: count=13 gas=925
  main.gno:5 -: count=50 gas=1850
