name: discovery
description: Tests a cluster with one bootnode and three peers to verify p2p discovery and consensus

cluster:
  nodes:
    - id: "*"
      config:
        consensus.timeout_commit: 100
        consensus.create_empty_blocks: true
        consensus.create_empty_blocks_interval: 0
        p2p.seeds: [ "{{bootnode.p2p.laddr}}" ]
        p2p.persistent_peers: [ "{{bootnode.p2p.laddr}}" ]
        p2p.pex: true

    - id: bootnode
      role: bootnode

    - id: peer1
      role: validator

    - id: peer2
      role: validator

    - id: peer3
      role: validator

scenarios:
  # Wait for the initial network formation
  - name: wait_for_peers
    params:
      peerCount: 3
      peersInclude: [ "{{bootnode.p2p.laddr}}", "{{peer1.p2p.laddr}}", "{{peer2.p2p.laddr}}", "{{peer3.p2p.laddr}}" ]
      timeout: 30s

  # All peers should advance to a specific height
  - name: wait_for_height
    params:
      height: 20
      timeout: 30s
