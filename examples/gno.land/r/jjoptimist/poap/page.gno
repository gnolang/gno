package poap

import (
	"strconv"
	"time"

	"gno.land/p/moul/md"
)

const totalWidth int = 62
const interiorWidth int = totalWidth - 2 // 60 characters available

func POAPListingPage() string {
	events := ListPOAPs()

	globalHeader := centerText("ğŸŸï¸ POAP Minting Dashboard", totalWidth) + "\n" +
		centerText("Explore, view, and mint your exclusive POAP events", totalWidth) + "\n\n"
	
	querySection := md.H4(md.Link("Query POAPs Owned by a Specific Address", "https://gno.studio/connect/view/gno.land/r/jjoptimist/poap/GetPOAPsByOwner?args=g16vfw3r7zuz43fhky3xfsuc2hdv9tnhvlkyn0nj")) + "\n" +
	                md.H4(md.Link("Retrieve All NFT Tokens for a Specific POAP Event", "https://gno.studio/connect/view/gno.land/r/jjoptimist/poap/GetPOAPTokens?args=1")) + "\n\n"
	
	globalHeader = globalHeader + querySection

	globalFooter := "\n" + centerText("ğŸ… Proof of Attendance Protocol ğŸ…", totalWidth) + "\n"

	eventContent := ""
	for _, event := range events {
		eventTopBorder := "â•”" + repeat("â•", interiorWidth) + "â•—\n"
		eventBottomBorder := "â•š" + repeat("â•", interiorWidth) + "â•\n"

		line1 := padRight("ğŸ†” POAP: " + strconv.FormatUint(event.ID, 10), interiorWidth) + "\n"
		line2 := padRight("ğŸ« Name: " + event.Name, interiorWidth) + "\n"
		line3 := padRight("ğŸ“ Desc: " + event.Description, interiorWidth) + "\n"
		line4 := padRight("ğŸ—“ Date: " + event.Date.Format(time.RFC3339), interiorWidth) + "\n"
		line5 := padRight("ğŸ–¨ Mint Count: " + strconv.Itoa(event.MintCount) + " / " + strconv.Itoa(event.MaxMints), interiorWidth) + "\n"

		var actionContent string
		if event.MintCount < event.MaxMints {
			actionContent =  md.Link("[Mint Now ğŸ›’]", "https://gno.studio/connect/view/gno.land/r/jjoptimist/poap/MintPOAP?poapId=" + strconv.FormatUint(event.ID, 10))
		} else {
			actionContent = "ğŸš« Sold Out"
		}
		actionLine := centerText(actionContent, interiorWidth) + "\n"

		eventBlock := eventTopBorder + line1 + line2 + line3 + line4 + line5 + actionLine + "\n" + eventBottomBorder + "\n"
		eventContent += eventBlock
	}

	content := globalHeader + eventContent + globalFooter

	return content
}

func Render(path string) string {
	return POAPListingPage()
} 
