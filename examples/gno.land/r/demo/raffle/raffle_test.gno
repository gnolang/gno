package raffle

import (
	"std"
	"strings"
	"testing"

	"gno.land/p/demo/testutils"
)

const (
	validTestHashes = `a657602fc08191e7a4e0255a818a0ec544c8ce0826fe9ecf0c47eb538b2a9920,e4ce35fc370cb77c8416d6cf248e406c3f41073955d2d1c46dfcde630437711c,d1c73632a00861c2a57502edcc7105df21e22f6f4764e07dbd76c1dd456fd763,5e9a113e15140d8e7ec30a70d999038970da4dc84b8517fdf93d8eba56b4f4cd,d0a8e682db50c4b5f16dbb1c206cc8086f58094642d5864db8cd5feaefff0eae,6d0d8c67778d4ea8ac5ed234c12075b7ccb96350ea84711f455eb1538ac30025,e287bbe122d9be4c90d2fc62e51abbc67de50f6c8044636a61e7f801081ba907,6c4567fdd88ee306f715eac751010b5ef8a66bab66258e580be4915898b1dfaa,85463175e47915820c55acbc2531eaf360a8c0586c3b59cbbf270efcae64382d,b9efac79a5d7a24930b1429e884c0e8834954c07d71fbf65eb2c6ed9deeb4b86,e22a3c12a95f1f07a0efc398da7c39c4dfa75447f17a03184271cfb5a5c96878,38b9840b1b4424a90d4999dae44d5e84b91ca5ec9f9227019134b124e17d9365,e8938fb84352f04418c0004d647b83627f9a87ca6df5565acb3af41a5ae4e96a,0230a0c0692cb9a8a5ef678e43f6693c48798ca10cc18694beaffea4825d8ea2,df9656caee96c6307c2a5f1b8e7ccd5939ec5d5d20902865d6bea75c696ece8a,0826a9dd51b29e6c2a5fa4851b9901938766a966be238bde273b4e18d13d8f52,3b6f3cc0d0a263cac2542c2280f43f15fbcd5e84a8e381def4f85ead1f50fc1f,203d4d1fbd75126347c4d6f5507e9d0a3a3e7c882add72157a036c9dc4e66512,7390338a73bb575ba433c21c4f20046fc84e068569ae4dd646105a9a6a58847a,336dd7b5898bf4970a26b5b4a6fe676b5dcb8717e001c9b35bb77ef470b4a7aa,8a9664c99a6f9c834aa54c4a762a31e8047584637fc9062e5069c0aa72631424,f1c8980ccb671cdebf22a160a6e80d7e32fbaee249642d0542b0c200d49aba3c,53448154f4b36b94312be81822b1b5e50dccfdc79b32e2c22b16ccc6b7d578d3,f70a7b08f88830a74830a78e9cec3f8d232217b113cdda0c8999701ad03e8d9a,ebabcfaf537123853c1f4fe32663ab2b9940ca380a469c90b4335a3cd75ad845,f11b62e725abd3132689a08c414a9d8056306685ad579015234147ca8d951ef5,e8746cdb50ea505868f1b14a639befe60793e1b098595ada30da9dea8543f85e,d64f3d1df00b2499d8dfb70a7ec677b6254194c1cc6fbccf2a5de0a1554aa73b,bbc3769aeb96573e828bcb88d4043326422a486cd7408d673f55a74c2bceb905,89b3990c08d38bc4f157d83dc4a3de9daa22d47eefa2b8d2083b45e22d987059,befa5f82ba8c1e203827afdd525b1bff339db39bd687499e67cf4ea0ff1ea7da,35248acd0ed6d6a551b7e6bc46f5fb6c5e00e996021298370a3a6145e45557bc,bacccc0dddadfa4e5ce03565a4d60fbfa13e4c6df882b4c5380c63c2fed1c72a,c3482d84d0f68d7340aea787390aa271051697c9f6189e01c970ff18cc871113,d03111e4fcf3c5706acbcdf03408f27c392de6d622b6c587fdc01a15aac8511d,77d3c66add6417b3c82b33ffc4bd56f99f0e1f2ad6b50cb7dfa52cc20fbe53c6,de52618ddb2a0814d537e701065d093dd99b15ff8ed9df4a47fae47b36191144,e5b2c494f09c57fcc1a2f1c81b8bd543418561195c1b406ff0933c80bc43926c,290862b65579a5a9e7b7af38787aadd098db50c474fc8973f1d40935c2abdff8,4790aad6ef509672d5b51ba192b1465f4c7c8c8ed5575164e549502498cdc314,bf421d436ac5cac95ebe884d84c2bc10865b614ffda07ba5e47bcfb45d0cae68,44119bae5a9ad9707bf4ae45b986db6c14910549c134977cfe4a9722d8bb8413,8b66d6f823efce27b5dd4ef8df2e7c420f977683ad951e55117133c96d3a2fef,7950ef46b73ee87379ce9bdcc80e7fb5cb1e2a0550142d09772f5adb48990783,47900068bbfecf6e272a543101b24e3284cf97d20f10c83e0cef34fd3d7b8939,9b70918fe6fdc6b997251f8988b1e28b26fbcf5b00aa009b54ed6987954b1054,87e5fda75dab4f89646c832951c3ca0ee2ed7908eb67be8b7665bca0c11d4863,e2401111629a0f6b97c09b98cca394d653ef3b2b7b130e6dd97a1bd278be6fd3,513ab2a40f29de856e9e75f7f556384b5793b52630966e2572448201b4d91241,38ce4e383b82bba6324efe0b591a140e108a140d348964e12fe4095f1ec28836,10ecfdb05cccb69aac313df1b85b6e9a8d16239fc72b6ba01d54cb3a01367d23,63a2f5ba3d1e707b0d2e7143e6ae0b59d2db066c910d8dac1044282a7b414a2c,5358b5d792244a4a9cd76b1a53cecb72edd8ad86b150bee596bd111984f37c8d,f1472a16d28eeda10cde756bb0fc9b1edfd72086ad1b7ba848f3b2c7c0c1ba60,12e200388a96f0c880cf48e93b2ea96287b7295b64ca80618e0425bf57fefc12,ebcc48149e5fef8d883c2feab956bf116beaefe8ab9eb751ccf991036fbd21e2,0c40425718e03bb1dd82551fce54f4580e8220fea9f6d615b026698fd9669c80,4848690fc49a95c439cec58f89982b58840164815d953c8fa87ccaaab2bd1731,6a16bad26a7cc979a4f8e5eedbc80fcfd9ed7ecab91193becaff50f33efc28da,ebb1a01c03117dcb0aaea770106bbdeaab4977f48c996a4f099afeb1b2facfdf,01b214bd9fd35002db91584f4eaf2c6be48033f47e10de7b3688a8ec03c3ac76,7826ebc97a654bf788cb023f6be2dd87989948ed6c1459af75d66323ec609933,f5e1f76ada455535d638d72d5ef1026376845487d1b6f36a260e4c7e9695601c,3f7f2d5f5a5880ceb62584e53b591be6daea1c1256e40d08bcf800341c0f4998,81d396417b5c2f4fa3ba7ff9a549bcc4828c67023f02e312a1d2b04d6a0dc284,a038ade0998e9b9f9b8f6a6c07f1fcfd71a94c2cede2e008c01f20c5bcd8c951,440bf41f1820ae151a8b9b7d9929092506b9b37ff9008d25b420189f6c5fca13,3a84efff563cbf7b4d8d5cb263f4f5fe0b165d6489ef97cb5f027132637d5966,7424bde3031042dca9b2772420802729013620f0080339286714a1cb025819ff,7ce7ac17c0ee78366435633c0e6a7856a39191acdd31e0a4fb8ac805e34d46d3,aec871aab9cd61464a27bf28f20f9787d1487fc7db381755b446eaeda32bef95,1776c5cfe011cba0de6adedc058437199b5b4d022891b700ad34c253bf51f528,77c42978cbb6d4e9ea009bad225ce9c6b9628ef385b0e920d840fc717640c2a4,0234edb9221988c6f9926a02875e25f902636edf0352dba3119c80576f6d234a,a3982bc2e9fc9bf4ba8a557faf0fe3c87c7d70704cc34bb257ccce850a56df9c,1028d4888bcbd6de66991f55b05281908a43bd721999e52b864043e5b20a1b4e,1243e8b9d1f3f9faf60a3ef85df793a21cd32fe70be208daaa8b581ef2ce8e68,f126a0245767f09b0673b4db69cd15c21f5bd30db6a4bba8d1a31ea641d58b33,3f2c79cfe02d3997fceb691aeb35d7cd57de441b4cef6e30b9b962deef9c50b9,f5fa2ea7bb2b4c8c6ffc48161983f88bdd19be45a57fc98ff9c1fff82f801014,d8df89e0cdeb42bdc936da63cde0fb936f56dc234da63917663fd7372b7660e8,0e8b757308130fedef4420b79e3d3945e6f8d2d17850eed9309e4d130f654672,b997b5fc7ccd97a0539bda23185af6f510eeb5d73de4fcd6647784567295bc6d,a3e3ef6e658b4466bf2171c47455a80cc2bec6a90dcc1fb3390cf744eb53c1c7,8fcbfc5d27166c53d080f471d16f6bc8e8aebd92f0dad07de4b859495ff042e9,28a00715a1445747db570f4072a94bb51e3174665cc256982f68eb73ae373ea1,b9a85ace3beb1b30f5246b3226efd57c9f829799fe621585ee7835f55d390960,76f2d988a34611508881726f80b18430753a9bddaf239fa1e3ca248c07f563d1,810a984e20a8f0d9fea02b69a9d0d7ee64743d73c24919f060355c58221659db,ec0ceca541ac704ef78375ce66bae03e2ac7f948e14d0702702b5edd44431ed8,45c038cfcbe4bbaadb423bfb6d69aa166bc36444478eddf04dca330e747645df,66978f4b114af8a2c7bff35caddd57b0e34d4469422e1f5177d84efbc29e9f9c,68deee2f5ed12726ba48c143de86f5bfc6f52e42387b6b118bd6adc15c6398de,a0db86d2a0c9ce98a0e3e45bdcad8786af03bc8c616726b39e73514d242903fa,585814809fdc5504c535b33a7905c9eb1fa3fa49d614de3691714738ae50800c,1302a8f2dc151addb559c3078c9ff96e4d0c0830e741837ed7167acab0f9c665,4142bf0dad7aed829ce45f47b9dc7301c99ce48eddc44eb72bbcd790238e51df,7258b40d72fa503550edd920756c4a1707b73bdefcce5ea94e79077e215c2ac0,14e73a66c7000d5cb2e2814cae0efb467f7a7db3ff586781127d35755ee90dea,b0847a80927caf523b377dd8e6afbfd29d9d247489f5531492b52a1603efaf31,1fcbf67cb147f8550780d80e16f5a9e22e28d5fd73ad04c7eb05f089173f8e6e,4b7ef70b85443c71ed7d39c56825a8d6faacb85a4697cafa4945680a0ad3a9d3,5915da1266757108bc408ceeabd04a99c93f745af0462d1df9ac42384cca7e07,b3acef10f8a2f04d21dc8856c7e138f103dbdc5e6b34e6871b12eb2ec6907a18,8da8f353e95c27476094aa037c06d987f72ab08ea5927af07bdffd24467a5f68,0502db50a5bfbbfac71e959bd4f372a47e83ab6a17a255b0e60b402c122b3fc8,04ee807da45b9a2a8a1cdd0148e1babb794e9e7584c55f370a2f723a16632c2f,79ed422a442f7b3a6b194660ec90560b742b9ba018c2bedd72d6d5a60b332c5a,07fdacdd8c1909fa7042e20ffe2d5f5bfcdbdb59ebf3e11886d02a5f0fbc05ed,361e57a73aec8cacee32496094263948fbd6a9d96e731fafec127eb9fd813f26,c36e6c40c3035c5dc4d8f015363c4591dff5a0e2065aa719c751cdde1a81bcbc,9bac59d959407ea715e81eb23ce43cc88e462c5a25ce525a5dd7b417ad7ea7d9,8dc69bf8158365d866d999fe69b6a7bd869961bafd09863b30d7d6a114bfc5b8,b00f70f3daa8b95576f82c3e59ecdd8558029ee49fe3f726a39d06a1e8fffebe,7ea988c095c4107824bced289ab7d21136e81dddac6a57af836e639135a08e05,966476658b04905c11608c684e267508c9f875f90bb03178b6b4b93ec2f98f13,f2d19b603793cc43563223651b218f8e465f1bfbbc803ac0982e75c8424e12e9,87610850a33a00749627bbc7c6e0aeff65813378733563d05b09333ed445ed54,b980b9789136661518c8864a2caf5f5ef7564408d05391888d25695d6bae1c9b,5fd10e734dd73befd2506c7a4b3d9c453366788763933a32ae7c8a1cec69c000,420858c69ef2cc9b5077f786392fecefbbd76501a8843ca13755a8efbfe6c6d2,6c6dd279e6b135970fe3352b41771341ddb0da7b41b5347b53004970ca2a07d7,247bf14ff84a4c498caeb9aaf249d186db1f84e19363a1a3f118801a57ba09e6,2d568b421ddbe5486bee08dd6d1c584f3311eed85dc714aea72efbc8f26b1b66,274b1391e2d9c3416515ecc8d10061cd1918f9fa9b7e91c7e96934e9cb6bc8a1,25fb97b440fd5a8c2148b8301eadb6419c1350003e4d9f2956a9e782a3e898d1,2d1bf699f5a8f2c5b2817eda0ef641947c6abbe7382fb888194e1d5fdad09566,330b374790e6d56d65f871ceb5a1779bc9859ddc29fd7bfd0d2e2a36936d9e98,3ad6891a7801438b4c695915e33ab8b7601e7f96074425b4dfc81ac76d6d09fa,8936901fa82ce332b699810e836e5320b0a0c5a267be7d875f991607a4eae282,d96bffa8ce37e4148483ff508f2a60b6629938db37b26664be8f4de4e8f9be27,7b4fde34ebe05d8c5a6c7c9bf0caa3971173bbbb62450179db376c1183325c65,4e38a924326b672f732602e8b926997eaf815cb8d9552ca8b2d694d0ceb74621,8d88853e489365132031f1c19f96787bb7955fadf3a33210222260c41b46fee9,73c500ead65ef2286b5140e06deb05ec11c78caa32954452e9ac50f01d4b1574,a8fbe2c40d74d690018dcbac28ce03edac5e5078d86544f04d422cb94b2dcc5b,3070a2343f71b624450db8bbdfa58ad1d4f20d171120fad69163ff68d969b36e,c4b2f358fc2cf8d771f8adc21419ed06fb3c2eafb8aaaf57f9f0036b71b24a79,8b33b6c3935ba61868fe6c3cc82dc09cf8956ca401e4081bb9070caaecd54a00,2440f69ab8f6f3a40c2bb83c8c11fdfbb69b32c6fb92a8059fc53f72c90a0fe7,dcb1b291ea41f4aa8f4632f62cfb20860a55bbcccd5b865bb36a8c0868763493,77fe31a59eddd7b925605d0081ae357da852d2530c820db0eea6418f826270ec,5a48b14d87fe45c7ef72def490db5cba84626720dcba876037241568ce75eb0b,28282b12ce1bf020a380fff1d6276f20533530ecc1fe666744c7761e80bdf7bf,f7965deadf987642563ceb0afe231c0ba0656547a83c3b2c58eb101cfc3b6df2,75f75d426cf3b26ddcf9d81e37ab8ef4e9421820f35abeec77e89fe2f229c713,df4ad30a4d19080ef444e9b86bcb539bfde6b6172254e6348e1f8677a6f8a2ff,72d98f1549d8125c6f98aa65ce936d978b7e46761c7b738ff162098b97ca22b4,07fc641ee6efc88323ef2928b263822f66b8bc844fcf686e8b6b809cc55cb28f,6fe314848cf6b71e3dfb97e81c58e8a5cfdd5c95907beba0d80cc733e338fc4d,edbb054b6a58f073de56cb76b962686aa3285cf0061dc1274c95d7d6091b3b33,600b8c1e159b5a119a8f2856c9da15f0cc407a9440c28a9c930b93319080e11e,dedfa5adaadbb507df7acd1aff8bf15e792556ef5a20f7ed8f2f733b50a2a94c,266161aee785bfce4cd62bb7f373f7f6c5843042aec46851858b15be81f99c01,a27b39e042e6b6d8a409c02ef510e87bb4fcd6d17a583465f1e3bdef8fd5ff66,bedc14158770ae8dbc3cf5e095890c1ae813a71519a1599e12d318c109a03d73,eb6c718e060181374cbaf61401df3fe4795b5ea7d69071ca54db7ec46b5f39d5,1db3779583cd8ddfebc1c33b9554c259e73ce94f352c8b9dc65d91b945f42508,9d178e34adcadf94b206f0d04956160e3e6f1aa621ee7e901f43d5b4993a268d,6852d1772470588b412382efa795fd3839c0b5f0d5c73db60ace8d9f0654f5ac,c16d4d475f5bbf6b0fefe2c737538109175d619e6fbf84fe0ddffaa107f49624,4a2d53b4176333403f606c59b12561716543c596455de1883a1a08648cfe5633,0abf8530e6570ac69c068b160acc807b660331fb7f206267891772e05784f080,ea085e3675b4f1ee23aee81d920d14168f7740c4dae404f081263200c582d5e5,d1f88d59c10f517a00f8379fe0dd5ff60fca94e5e5a077432ffbb6a2b6f85a13,43a471ba0c43af7bc0e53f487585fc7e44a4262bb0eca400038a875430847ce9,6a9a40995191d5bc3bdb32b7ae6af6b2541e55576cfafcd97c9bcd95da4b5340,e28698e18e49e481b8a92b4102cb259584d81edf3f73468c5ca5509d5b5874b9,007b899ee4ad9cf389a4db03ed5ec69e8a2c4648cec328f0c669425089186604,8ae572d8a53847a30f5e9f2ac5d734341c2fac4fd8f574b2b9d9b24817d6e372,f857a1374f3cb2c80661ecadaf5d0e3622e72d77d266aa7ad2801e7db335b969,2e9eba7803798b99de5e59a3cb207ca53180326d7dddc4f80460ef1e3bca9f22,6d2d8fdc6bebd8bb5aebf5f4008856c427fc9b077cedef06d7cabdbb35230090,e88f5a8743a1e2cc24c07bf93d2566293ec90dc3016d6d561ac359f200afcd7c,73d8e522befb3985d72f69876a3bd5bfd656ef442af8db63f24e3802fbf7453e,09dc75bc71fad01c85dc0c7a2dd4594ae3883bf5ef8155cd2856638bf467842b,69f06e1c5773eddc50d89714a081fd26d6c271355f609d171d90f09fdb6ad311,1e8fcdd32d547ec02338d40cefd09b02b28a4ae8f8972a4fafa158107f6a890c,79dffd0030e1dd9af958fe233cbdf1959ff3d749d863da8b92bf6d2edcd114ad,e089dab3bb2519de80cf8666f589e183f4ddf80f8778282694632499c093aaad,2f342899b6e2505b72a25f7f507298b4cd5b0400f9d034d45a95fa86d127b171,5b6767fdff5a39d92eeb8415eec49f48b958e9c38151ce4356d09e43f8b397e9,a70b2878df44bd3952d9da43fea40bb475d2a87d21b8d5750c2153163af39c0a,4526593e49e532e8e498a8b14c3ca15c1749dfac9cf39a0b44b4c18ddc319440,118502524e8a02d7c7ee2cb984b598f27afb3b7b78b92326b2fbfc3c53f48464,8379f7dc2c391ac38ea1d34ddff36faf5602bf128b6d93a3a8a6485b1d8dc23f,0c17a500636a9a94b405b8e9f2fcd45b058a4a9070c156332e429daf0379572b,7e302ffccaacae442283c86d2afdf7c240d19dc42c41440419c8b78efdfc9dec,a19467bab0f5a753e4daadd080e64f13c79bdabd7e403575f9f3d3b7b6ca66fa,4162c48bb1ba5e8dd38518f9d1007300e46348e01a97184e253a3250ed0f9ffb,c1e36882f77da60283f64d2590e3389497e6583fcdb61c21d352d522506a8882,64a4716a19fd7b8009a5e6d5924a74c65ef8e5f85c64345c7b89a4e6b6135e5b,8136dbac064d798c9e30bf31e62d74f99ffb37d3bd9f3d6d3c6544669ca3cded,790f8dfbe56b27d1b82b00bf96394caa4ef54263229bf3ee5b2aa891ec8b5676,7d060a4e92f2c1f4cd2546f5409cae2c946b70556b249455dc19fb93e8dcdb9d,8e62713fc4972433c63b1c0c19cc1d291471381b11183b40e450263956a4d1f8,46255b9d4d2059337f3949e4ada5c2d16ab8385f66967291e204175aa2120986,49023745977f47f7439c701985905ad2be42b2a89c070df73ea8dc7f9c5ae627,75e6c4c28e4dedef545bbe58ea2b497dffc90ed7fe6d7261287e90cd85a3fcfa,fee9501fc25e4c85c0d205473426d6e6f4e02eca002eab6513c6467885486fab,77f39047575527668b8c86defb3a15328d6f6289ffb1dce1b01fd1c9f193f739,59e80ebb2f5424610ffc9070e39c64805a1d6a44f52993eaf0b427b3a8494b99,bfddb6b1867c2d0cf3ed074ce94fadc786226f28f98f9f1d7ac5bd6a1e040f9b,4c6aae8655346883ce266665e0c61461636a128c8804d6aca78f9c8a35356fbe,bf4462bc1f0c88cd99e30a20c6b6eeae09f7a17a737314192aac8b40056e90e1,f448286e1d5a998965efeed87d8feffd6ecc3fc0a9a8658730da10715324f89c,7619cfb410a5bb992e9da50699a6cdd82a0279e27176ebf4c1c21c12dea2459a,48395b0355072b681c77cf4684dfa228f4009c4985d013908539e34d306bb4d5,6fa9d11c314c5430db8ac179f7e1517d754781522b94f2da800a3d9db8a191be,79462eb8641df40ec28d7ae89ec7f1d5548b7b0316fb03da682726b35bfdcf7d,dbb07ef67043d85768c04c5c68e98a88685bd2785a3b20ba574403397fdcd33d,5be705a5717f0ad7688077b80765f8eac1be081d07105c7ab342db817461213e,0314be8e3cfcc6f00f5a0b3ce074f844f8126692bc9db1951df722379ca37622,b225bede76fe85a80c30ec258bcff80f9226fc3b3c07e1c75aa43e38968c85b0,ecceb05c114658703ee5bda417b23ecedffc67129d59b52a4fb60b9aad8624ee,56d6e51283d0da2e6aa6d8a166178aa5bf97c0d6ad8b6514a2b1a8701a890a54,274754307e41b8a6333f8f2d9bc679640fdeaa6954c94d91b022185d2e0f64ca,1c303f25b84f7f63fba0c97dd1ebf1148c1968658dca21b27df47ae2b86c4c2b,04638bdc28da59d45407c756701e4285ad0487858e92b2e45ccf99ffafaaf73f,ed4d011b44c9801335df5d3b5550977b11a1e78ec7ad1ebb477ad2eb707ddefe,333a3f0c920bf95d95cfaaa069a17ccfb0998ebc5697764788642ecb69c1746c,c6db8bfb6ee98557377bf8886a12c5784f613a53db3c09c161938039706941f4,25c3e1dcd0d27d63978adcefe9f862d9be8e20ed44bd80c359ffe99bc72fb095,035d2f21a40a3c5f97be226cb26e792130ba0d56dfe472b5cd9e1fd0b5d557f8,16411af320b57bac481c370cab692121e93edc942c2a6851c64737951a9594a7,43cc758c0134246a8a9e7db3f08a63709f0db02cb8431c21319e832845e3bdfe,3d9149f5c36eee7b661628d69b8d3e323b4fed8f544f8ca7b1bb575de94d465d,85ce96c84ff64f03e0c8b72dc9d6f2a4679c034836368345e22ffd0a170ad62f,2691d4f78bedcd4a6f6fa39c45a0109e4a11ce7603c656b53cca835d3863e06a,cbd21277046ea7f4572d6e8149077713575239ccf8a98c56b162b633a6490cf2,30335f29996cecf0747bf4e2b44f8ee3959e4cc277317d48e80f7726a85d87ef,afbde53c640182877df7eb5955d42669c5aa54e65ba304d6bdfb1be002cda374,d053a7b55ccdbf594d95fa053a1dd93d41a72e9c29b15b68e571e482d33277a4,3ae128f7b953405c2cd293c2e62a9c99914a7ed69d84c927c518bb9fc21b74d5,ab43d526f1dc6a32395c49806c8bc73bae918a5f3cb5fc1d0f99cc32e8d45867,7c5151e7116ff12d2325c9b2e98256e43802f6c4a15584be250aecbf143f50e3,5ee1a8ac394732056708b628216815b744eb5fefcff8426eb48d682ae7fe0bdb,e1f06ae08a52e1e4e7544d0ee343d33ba6ea5a71d7ce00c56a3f14058a199d78,771032904be77e19c389ae615a39e78aed70ae8e233edd8f3d5aafee1e4691df,cf0dfd60ef8f949ec0168439c7022546c5f00634e7fdd668900bcad1e2e81756,84bb868f3ec690f914e3a8cde683b55653e554bf5ae6516304ca95e3e0be0ce9,2e6bb4a91f7df30a0fe05ad3d02ea64b6a571a089ecd6e1a2caf900e5175949e,566cf7e6d6419fff93e8f18bd34b7fdb2db9b2d4191434e37a97e3a5cd00b186,912729b57611e1422879af83c5d11bb416c0b98fa83dc392bae590d7e90d5d12,54a7f54922ffc66260dcf30076c4cc7fa254cc9b830b2e37349d7b40f0d67231,d2cdfe1068809e2e519bec2fb30eff036085ed0fd5a174157f4a531be489a9c4,00c19bdcfabceeef4ab4c71251f41d59173c43b87ef0e968e7aa5bcf77fc3aa3,00a1b917cf86485c9e86030ec1afe9b7e28a4345f46471b92b4e0d08b698bae5,17b23ef7d38a3a0334ef68087a585ac48956984f6e0321c62d30011368954485,1fb0c2d4d015596c3439f405da4a7a2497ba94cdecb535e70cfda08c6a764f4f,993c1131175eb1f3b8b5d1d72ea5addac559a20b5154838ee86aa9b71e06652e,2ede50271add1f8aa5b91bcd222d83eecea7f4a524c9e62ec01cd889a55aad45,20ada1b4fe496096230fec2c00bff8a037db5079c6f45955317df9c2ede5f85b,b37b8821965b243026b83a59ea4e4e2246545fbcc1100d8effeca612a3b6bb4a,0760c516052f81058efd89aa11573c744ffd4f5685e11e9e200bd0ba0228ee34,fc3cc3b0dc5592a8c0a2e41d3ba995c0f65efbf2797c2b7b2403bd2c552acd64,0475e984bf932adabb1fe98d943ad23fd56e4bd53c2e7bbb12ea69b7996430be,d60ec04ea36dab7f685a2dc50c2f76ede60a6b594b15317d7e32d2438eef36ef,13dbd661bb4f0bc0854b761b94470f2c8d3ea069c2b2c53d07f40da9668515a2,875472cab949b679152079e79cd06ad376c30f4c298b2f7e191f5f7ef3aa1ccf,bfc95afeb7c01ea29780954bc62c9830af90e4a8882b64d24e65d7c30e075e48,4d100b664eee670a68d88d07bab4ca55dad28da862b2af631b29d5031920e10d,1275cde34b3de398a87fccd8bfa2261f826983ea774a0a413843f9de07beac70,b3cc121e4d7f7bc008ecd7d79b2f08d32c34c036c64678ae7cc43112b4297210,46a13985c51e2cae515be2a8f1eb0b42fea64cf366057a611cee74aaa7c648e3,df40e86985f66578e1ca70bea1c1a58b943c3b37bae49f639a547e759239513a,448cb5c2de497679de2161a93b5e0983a6030a33a59eee2b3171c56a93bc91d6,e6b371651baf1c9773ee1e240d51deda5f237e8da74048af9f3379f70f1c8e2f,d24ec5de76732220049843cf0ce87053bdfb223d8e45cdbf83a8d801ed486850,4131794225ae70468171aefddf3e5875a8ab294263ae4694f93a68e8314b0b5c,f5958acf10e9d5f12d9b0349bda1e652273977c36e1ad59c383bbfb512abcac9,19dea7117e47e557bca2019c09173879bde7a9703e7577ec5bf2270fec6aca6e,3cc640e6348efd77de2a22367f609c2f68551d4cb917f27c32c2dbc422827dfa,61d21b2cb4586c4ce3178f6ea51d905d9d00d79d85ccea52e5f4223811e12a44,44e06b75ecca6b3a9f91813c716c0f61f5990f498c5ed17a41ddfcdc0db48368,8da1c8bd377bb3892265639b26a72b7780393a8a43f6471a5eb1abd1ec88ef3d,f5e58a733b69af1ef5fe8a9a580b3790a792e44ad32a29e98d9f7f142862b298,d1e1dc03f1d6d75da644b8a14f8e7d3906b47d50968273f0707142bdd810de1c,d1869756e1200628a18e401e9510a9f78604ce91faf67c2e759a7b28c6eb882f,60dca01fbd010aef036b6ba742978ebacd1c49ba999e06f1b7985c5c0e96055f,c731ad94fa972ca5a7bc709d2cccf187ba47bc6299dcf3301b62990064e04fa2,d1cffa5c6c044dd22a8a0990545ac7bf5edf04b38820230af853949612ef7075,cc351a659c1718306c90276e7a58697709b69d2dd06af2dec6891ac77ac62a3c,82738ee011e454410ea714fbeccad19fe15dba4e62b7d1b85e65e7f8ed2e6286,2d2f067acea2451a17ad0f2beeefcc768dbf52a01f437a5066f49fac1d3eb312,fabad1b8e1b3a3e11810c408f748a7e70449f4274aaaaaf69b11ffeaff1504e7,4ab824b1479ec872488f501374e22488e0b8b4612ea16cca5208783016af9858,1b5dcad92079e86412309d5f85b01631a7aa3d7eda261080531cdeb89c96bcdb,a1809967d96449a3535d19e509fc3ae58b714805141f6487aaf06a7b00f47dc2,081fde0ec6f26348e2626daf44d932bc31d3ac3cc6546061484f9f68b0499422,c3d10191066b94c7a89f91f75fc9aea86e17ac5894fecb8c0698957771d196da,b5474f0aebab60ca12d4f8097a499f3fc063ad6146eb6db4191bc05ce82312ed,147a78e0d0d68aa642b97ba83e7b45ff5b367341f0a0a4f551f593f3ed8855db,47b2514697f7793be6f9ed37ff3cee74a4d1a3012d468c6069c50b6681ec07d1,d59ee71f32fc530efbc54952356a1e564e7fb077b9323bc032f6cacd7ed47917,f0c7fa099c97483728d04f577f5b1462443136e52b9434b5875e00984eab9fc6,a8d103d654099371f1a97f34cfe997683000cf2e7a525376d6af1ac2b75d71ac,cc5f68d406097c09e8d86b667213f52b77d3e0e543c86e3dbede40e8c1f7490d,b495595a4d94415ad9e3c6fbcb8589ddbaffa7d0c9077fcfe261efecc76bc957,f4359ca550fc3fd61f08b20e7714d37f1ea257a2d548fcc6a40cbf1bbc4bfc2b`
	validCode       = "qd0bJ6HTSV"
	invalidCode     = "qd0bJ6HTSB"
)

var (
	alice          = testutils.TestAddress("alice")
	bob            = testutils.TestAddress("bob")
	aliceUserRealm = std.NewUserRealm(alice)
	aliceCodeRealm = std.NewCodeRealm("gno.land/r/demo/alice")
)

func TestUploadCodes(t *testing.T) {
	invalidHashes := `1cdcdc252a3a8c2d1516527dcf3ee63b4552a6bbb41145527409d8a8b6185c40,551a0108b23cc4bdff4c716a504a677551d68162ada5b9e20ebb21f4d7e83c9d`

	hashes := strings.Split(validTestHashes, ",")

	defer func() {
		if r := recover(); r == nil {
			t.Fatalf("UploadCodes should have panicked")
		}
	}()
	UploadCodes(invalidHashes)

	UploadCodes(validTestHashes)
	for i, hash := range hashes {
		if hash != CodeHashes[i] {
			t.Fatalf("Expected %s, got %s", hash, CodeHashes[i])
		}
	}
}

func TestRegisterCode(t *testing.T) {
	UploadCodes(validTestHashes)

	t.Run("EmptyCode", func(t *testing.T) {
		std.TestSetOrigCaller(alice)
		std.TestSetRealm(aliceUserRealm)

		defer func() {
			if r := recover(); r == nil {
				t.Fatalf("RegisterCode should have panicked with an empty code")
			}
		}()

		RegisterCode("")
	})

	t.Run("NonTenCharCode", func(t *testing.T) {
		std.TestSetOrigCaller(alice)
		std.TestSetRealm(aliceUserRealm)

		defer func() {
			if r := recover(); r == nil {
				t.Fatalf("RegisterCode should have panicked with a non-10-char code")
			}
		}()

		RegisterCode("123456789")
	})

	t.Run("ValidCodeWithUserRealm", func(t *testing.T) {
		std.TestSetOrigCaller(alice)
		std.TestSetRealm(aliceUserRealm)

		defer func() {
			if r := recover(); r == nil {
				t.Fatalf("RegisterCode should have panicked with user realm")
			}
		}()

		RegisterCode(validCode)
	})

	t.Run("CodeNotOnList", func(t *testing.T) {
		std.TestSetOrigCaller(alice)
		std.TestSetRealm(aliceCodeRealm)

		defer func() {
			if r := recover(); r == nil {
				t.Fatalf("RegisterCode should have panicked with a code that is not in the list")
			}
		}()

		RegisterCode(invalidCode)
	})

	t.Run("ValidRegister", func(t *testing.T) {
		std.TestSetOrigCaller(alice)
		std.TestSetRealm(aliceCodeRealm)

		res := RegisterCode(validCode)

		for _, item := range []string{alice.String(), aliceCodeRealm.PkgPath(), validCode} {
			if !strings.Contains(res, item) {
				t.Fatalf("res should contain %s", item)
			}
		}
	})

	t.Run("DoubleRegisterValid", func(t *testing.T) {
		std.TestSetOrigCaller(alice)
		std.TestSetRealm(aliceCodeRealm)

		defer func() {
			if r := recover(); r == nil {
				t.Fatalf("RegisterCode should have panicked with a double register error")
			}
		}()

		RegisterCode(validCode)
	})
}

func TestRegisterUsername(t *testing.T) {
	t.Run("NoEntryUsername", func(t *testing.T) {
		unregisteredUserRealm := std.NewUserRealm(bob)
		std.TestSetOrigCaller(bob)
		std.TestSetRealm(unregisteredUserRealm)

		defer func() {
			if r := recover(); r == nil {
				t.Fatalf("RegisterUsername should have panicked with no previous entry")
			}
		}()

		RegisterUsername("bob-username")
	})

	t.Run("ValidEntryRegister", func(t *testing.T) {
		std.TestSetOrigCaller(alice)
		std.TestSetRealm(aliceUserRealm)

		res := RegisterUsername("alice-username")
		if !strings.Contains(res, "alice-username") && !strings.Contains(res, alice.String()) {
			t.Fatalf("expected to find alice's address & username in the entry")
		}
	})
}
