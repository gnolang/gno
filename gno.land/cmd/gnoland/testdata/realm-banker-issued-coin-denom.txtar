# test for https://github.com/gnolang/gno/pull/875

## start a new node
gnoland start

## add realm_banker
gnokey maketx addpkg -pkgdir $WORK -pkgpath gno.land/r/test/realm_banker -gas-fee 1000000ugnot -gas-wanted 2000000 -broadcast -chainid=tendermint_test test1

## check initial balance
gnokey query bank/balances/g1jg8mtutu9khhfwc4nxmuhcpftf0pajdhfvsqf5
stdout '"9999998000000ugnot"'

## mint coin from banker
gnokey maketx call -pkgpath gno.land/r/test/realm_banker -func Mint -args "g1jg8mtutu9khhfwc4nxmuhcpftf0pajdhfvsqf5" -args "ugnot" -args "31337" -gas-fee 1000000ugnot -gas-wanted 2000000 -broadcast -chainid=tendermint_test test1

## check balance after minting, without patching banker will return '31337ugnot'
gnokey query bank/balances/g1jg8mtutu9khhfwc4nxmuhcpftf0pajdhfvsqf5
stdout '"31337/gno.land/r/test/realm_banker:ugnot,9999996000000ugnot"'

## burn coin
gnokey maketx call -pkgpath gno.land/r/test/realm_banker -func Burn -args "g1jg8mtutu9khhfwc4nxmuhcpftf0pajdhfvsqf5" -args "ugnot" -args "7" -gas-fee 1000000ugnot -gas-wanted 2000000 -broadcast -chainid=tendermint_test test1

## check balance after burning
gnokey query bank/balances/g1jg8mtutu9khhfwc4nxmuhcpftf0pajdhfvsqf5
stdout '"31330/gno.land/r/test/realm_banker:ugnot,9999994000000ugnot"'

## transfer coin
gnokey maketx send -send "1330/gno.land/r/test/realm_banker:ugnot" -to g1yr0dpfgthph7y6mepdx8afuec4q3ga2lg8tjt0 -gas-fee 1000000ugnot -gas-wanted 2000000 -broadcast -chainid=tendermint_test test1

## check sender balance
gnokey query bank/balances/g1jg8mtutu9khhfwc4nxmuhcpftf0pajdhfvsqf5
stdout '"30000/gno.land/r/test/realm_banker:ugnot,9999993000000ugnot"'

## check receiver balance
gnokey query bank/balances/g1yr0dpfgthph7y6mepdx8afuec4q3ga2lg8tjt0
stdout '"1330/gno.land/r/test/realm_banker:ugnot"'

-- realm_banker.gno --
package realm_banker

import (
	"std"
)

func Mint(addr std.Address, denom string, amount int64) {
	banker := std.GetBanker(std.BankerTypeRealmIssue)
	banker.IssueCoin(addr, denom, amount)
}

func Burn(addr std.Address, denom string, amount int64) {
  banker := std.GetBanker(std.BankerTypeRealmIssue)
  banker.RemoveCoin(addr, denom, amount)
}