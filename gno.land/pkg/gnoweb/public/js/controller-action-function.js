import{BaseController as r,debounce as c,escapeShellSpecialChars as d}from"./controller.js";var o=class extends r{sendValue=null;connect(){this.initializeDOM({"send-code":this.getTargets("send-code")}),this._funcName=this.getValue("name")||null,this._initializeArgs(),this._listenForEvents()}_listenForEvents(){this.on("mode:changed",e=>{let t=e.detail.mode;console.log("mode:changed",t),this._updateAllFunctionsMode(t)}),this.on("address:changed",e=>{let t=e.detail.address;this._updateAllFunctionsAddress(t)})}_updateAllFunctionsMode(e){this.getTargets("mode").forEach(t=>{console.log("modeElement in function",t);let n=this.getValue("mode",t)===e;t.classList.toggle("u-inline",n),t.classList.toggle("u-hidden",!n),t.dataset.copyTarget=n&&this._funcName?`action-function-${this._funcName}`:""})}_updateAllFunctionsAddress(e){this.getTargets("address").forEach(t=>{t.textContent=e.trim()||"ADDRESS"})}_sanitizeArgsInput(e){let s=this.getValue("param",e)||"",t=e.value.trim();return s||console.warn("sanitizeArgsInput: param is missing in arg input dataset."),{paramName:s,paramValue:t}}_initializeArgs(){this.getTargets("param-input").forEach(e=>{let{paramName:s,paramValue:t}=this._sanitizeArgsInput(e);s&&this._pushArgsInDOM(s,t)})}_debouncedUpdateAllArgs=c((e,s)=>{e&&this._pushArgsInDOM(e,s)},50);_pushArgsInDOM(e,s){let t=d(s);this.getTargets("arg").filter(i=>this.getValue("arg",i)===e).forEach(i=>{i.textContent=t||""});let n=this.getTarget("function-link");if(n){if(!n.getAttribute("href")){console.warn("No href attribute found for function link");return}let a=new URL(n.href,window.location.origin);a.searchParams.set(e,s),n.href=a.toString()}}updateAllArgs(e){let s=e.target,{paramName:t,paramValue:n}=this._sanitizeArgsInput(s);t&&this._debouncedUpdateAllArgs(t,n)}updateAllFunctionsSend(e){let s=e.params?.send||!1;this.getDOMArray("send-code").forEach(t=>{t.textContent=s?this.getValue("send"):""})}};export{o as ActionFunctionController};
