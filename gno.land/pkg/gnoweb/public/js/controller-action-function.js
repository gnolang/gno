import{BaseController as u,debounce as l,escapeShellSpecialChars as d}from"./controller.js";var c=class extends u{sendValue=null;connect(){this.initializeDOM({"send-code":this.getTargets("send-code")}),this._funcName=this.getValue("name")||null,this._initializeArgs(),this._listenForEvents()}_listenForEvents(){this.on("mode:changed",e=>{let t=e.detail.mode;this._updateAllFunctionsMode(t)}),this.on("address:changed",e=>{let t=e.detail.address;this._updateAllFunctionsAddress(t)})}_updateAllFunctionsMode(e){this.getTargets("mode").forEach(t=>{let n=this.getValue("mode",t)===e;t.classList.toggle("u-inline",n),t.classList.toggle("u-hidden",!n),t.dataset.copyTarget=n&&this._funcName?`action-function-${this._funcName}`:""})}_updateAllFunctionsAddress(e){this.getTargets("address").forEach(t=>{t.textContent=e.trim()||"ADDRESS"})}_sanitizeArgsInput(e){let s=this.getValue("param",e)||"",t=e.value.trim();return s||console.warn("sanitizeArgsInput: param is missing in arg input dataset."),{paramName:s,paramValue:t}}_getParamCurrentValue(e){let s=this.getTargets("param-input").filter(n=>this.getValue("param",n)===e).map(n=>n);if(!s.length)return"";let t=s[0];return t.type==="checkbox"?s.filter(n=>n.checked).map(n=>n.value.trim()).join(","):t.type==="radio"?s.find(a=>a.checked)?.value.trim()||"":t.value.trim()}_initializeArgs(){let e=new Set;this.getTargets("param-input").forEach(s=>{let t=this.getValue("param",s);if(!t||e.has(t))return;let n=this._getParamCurrentValue(t);n&&this._pushArgsInDOM(t,n),e.add(t)})}_debouncedUpdateAllArgs=l((e,s)=>{e&&this._pushArgsInDOM(e,s)},50);_pushArgsInDOM(e,s){let t=d(s);this.getTargets("arg").filter(a=>this.getValue("arg",a)===e).forEach(a=>{a.textContent=t||""});let n=[...this.getTargets("function-execute"),...this.getTargets("function-anchor")];n.length>0&&n.forEach(a=>{let r=a.hasAttribute("href")?"href":"data-copy-text-value",i=a.getAttribute(r);if(!i){console.warn(`No href or data-copy-text-value attribute found for the function link: ${a}.`);return}let o=new URL(i,window.location.origin);o.searchParams.set(e,s),a.setAttribute(r,o.toString()||"")})}updateAllArgs(e){let s=e.target,t=this.getValue("param",s);if(!t)return;let n=this._getParamCurrentValue(t);this._debouncedUpdateAllArgs(t,n)}updateAllFunctionsSend(e){let s=e.params?.send||!1;this.getDOMArray("send-code").forEach(t=>{t.textContent=s?this.getValue("send"):""})}};export{c as ActionFunctionController};
