# This test simulates a user journey in the Gno ecosystem, including
# adding packages, using well-known Realms and interracting with other users.
loadpkg gno.land/r/gnoland/users/v1
loadpkg gno.land/r/demo/grc20factory
loadpkg gno.land/r/demo/disperse

# Add 3 users with different balances
adduser user1 1ugnot
adduser user2 1ugnot
adduser user3 100000000000ugnot

# Start the node
gnoland start

# Verify users' initial balances
gnokey query bank/balances/${user1_user_addr}
stdout 'data: "1ugnot"'
gnokey query bank/balances/${user2_user_addr}
stdout 'data: "1ugnot"'
gnokey query bank/balances/${user3_user_addr}
stdout 'data: "100000000000ugnot"'

################################
# Exchange ugnot between users #
################################

# User3 funds user1 (100ugnot) and user2 (4e10ugnot) using the disperse Realm
gnokey maketx call -pkgpath gno.land/r/demo/disperse -func DisperseUgnotString -args "$user1_user_addr,$user2_user_addr" -args '100,40000000000' -send 40000000100ugnot -gas-fee 1000000ugnot -gas-wanted 14000000 -broadcast -chainid=tendermint_test user3

# Verify users' new balances
gnokey query bank/balances/${user1_user_addr}
stdout 'data: "101ugnot"'
gnokey query bank/balances/${user2_user_addr}
stdout 'data: "40000000001ugnot"'
gnokey query bank/balances/${user3_user_addr}
stdout 'data: "59998999900ugnot"' # Disperse + Gas used

# User2 sends some more ugnot to user1 (1e10ugnot)
gnokey maketx send -send 10000000000ugnot -to $user1_user_addr -gas-fee 1000000ugnot -gas-wanted 10000000 -broadcast -chainid tendermint_test user2

# Verify users' new balances
gnokey query bank/balances/${user1_user_addr}
stdout 'data: "10000000101ugnot"'
gnokey query bank/balances/${user2_user_addr}
stdout 'data: "29999000001ugnot"' # Send tx + Gas used
