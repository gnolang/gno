# Test slice-to-array-pointer persistence when base array length equals target.
# This is the edge case where cbv.GetLength() == at.Len.

loadpkg gno.land/p/nt/ufmt

gnoland start

## deploy realm
gnokey maketx addpkg -pkgdir $WORK -pkgpath gno.land/r/test/sliceptreq -gas-fee 1000000ugnot -gas-wanted 20000000 -broadcast -chainid=tendermint_test test1
stdout OK!

## initialize: slice and pointer have same backing length
gnokey maketx call -pkgpath gno.land/r/test/sliceptreq -func Init -gas-fee 1000000ugnot -gas-wanted 10000000 -broadcast -chainid=tendermint_test test1
stdout OK!

## read through pointer after realm reload
gnokey maketx call -pkgpath gno.land/r/test/sliceptreq -func ReadPtr -gas-fee 1000000ugnot -gas-wanted 10000000 -broadcast -chainid=tendermint_test test1
stdout '("10 20 30" string)'
stdout OK!

-- gnomod.toml --
module = "gno.land/r/test/sliceptreq"
gno = "0.9"

-- sliceptreq.gno --
package sliceptreq

import "gno.land/p/nt/ufmt"

var (
	data []byte
	ptr  *[3]byte
)

func Init(cur realm) {
	data = make([]byte, 3)
	data[0] = 10
	data[1] = 20
	data[2] = 30
	ptr = (*[3]byte)(data)
}

func ReadPtr(cur realm) string {
	return ufmt.Sprintf("%d %d %d", (*ptr)[0], (*ptr)[1], (*ptr)[2])
}
