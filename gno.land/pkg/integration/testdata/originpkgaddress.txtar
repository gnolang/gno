# This tests ensure the consistency of the std.OriginPkgAddress function, in the
# following situations:
#
#
# | Num | Msg Type |      Call from      | Entry Point     	   | Result       |
# |-----|:--------:|:-------------------:|:-------------------:|:------------:|
# | 1   | MsgCall  | wallet direct       | myrlm.A()       	   | r/myrlm      |
# | 2   |          |                     | myrlm.B()       	   | r/myrlm      |
# | 3   |          | through /r/foo      | myrlm.A()       	   | r/foo        |
# | 4   |          |                     | myrlm.B()       	   | r/foo        |
# | 5   | MsgRun   | wallet direct       | myrlm.A()       	   | r/myrlm 	  |
# | 6   |          |                     | myrlm.B()       	   | r/myrlm 	  |
# | 7   |          | through /r/foo      | myrlm.A()       	   | r/foo        |
# | 9   |          |                     | myrlm.B()       	   | r/foo        |
# | 9   |          | through /p/demo/bar | bar.A()        	   | user address |
# | 10  |          |                     | bar.B()         	   | user address |
# | 11  | MsgRun   | wallet direct       | std.PreviousRealm() | user address |

# Init
## deploy myrlm
loadpkg gno.land/r/myrlm $WORK/r/myrlm
## deploy r/foo
loadpkg gno.land/r/foo $WORK/r/foo
## deploy p/demo/bar
loadpkg gno.land/p/demo/bar $WORK/p/demo/bar

## start a new node
gnoland start

env RFOO_USER_ADDR=g1evezrh92xaucffmtgsaa3rvmz5s8kedffsg469
env RMYRLM_ADDR=g1jcg3260hw7uq2qv62q4dfn2qhm7kndpzxvjwpr

# Test cases
## 1. MsgCall -> myrlm.A: r/myrlm
gnokey maketx call -pkgpath gno.land/r/myrlm -func A -gas-fee 100000ugnot -gas-wanted 1500000 -broadcast -chainid tendermint_test test1
stdout ${RMYRLM_ADDR}

## 2. MsgCall -> myrealm.B -> myrlm.A: r/myrlm
gnokey maketx call -pkgpath gno.land/r/myrlm -func B -gas-fee 100000ugnot -gas-wanted 800000 -broadcast -chainid tendermint_test test1
stdout ${RMYRLM_ADDR}

## 3. MsgCall -> r/foo.A -> myrlm.A: r/foo
gnokey maketx call -pkgpath gno.land/r/foo -func A -gas-fee 100000ugnot -gas-wanted 800000 -broadcast -chainid tendermint_test test1
stdout ${RFOO_USER_ADDR}

## 4. MsgCall -> r/foo.B -> myrlm.B: r/foo
gnokey maketx call -pkgpath gno.land/r/foo -func B -gas-fee 100000ugnot -gas-wanted 800000 -broadcast -chainid tendermint_test test1
stdout ${RFOO_USER_ADDR}

## 5. MsgRun -> myrlm.A: r/myrlm
gnokey maketx run -gas-fee 100000ugnot -gas-wanted 12000000 -broadcast -chainid tendermint_test test1 $WORK/run/myrlmA.gno
stdout ${RMYRLM_ADDR}

## 6. MsgRun -> myrealm.B -> myrlm.A: r/myrlm
gnokey maketx run -gas-fee 100000ugnot -gas-wanted 12000000 -broadcast -chainid tendermint_test test1 $WORK/run/myrlmB.gno
stdout ${RMYRLM_ADDR}

## 7. MsgRun -> r/foo.A -> myrlm.A: r/foo
gnokey maketx run -gas-fee 100000ugnot -gas-wanted 12000000 -broadcast -chainid tendermint_test test1 $WORK/run/fooA.gno
stdout ${RFOO_USER_ADDR}

## 8. MsgRun -> r/foo.B -> myrlm.B -> myrlm.A: r/foo
gnokey maketx run -gas-fee 100000ugnot -gas-wanted 12000000 -broadcast -chainid tendermint_test test1 $WORK/run/fooB.gno
stdout ${RFOO_USER_ADDR}

## 9. MsgRun -> p/demo/bar.A: user address
gnokey maketx run -gas-fee 100000ugnot -gas-wanted 12000000 -broadcast -chainid tendermint_test test1 $WORK/run/barA.gno
stdout ${test1_user_addr}

## 10. MsgRun -> p/demo/bar.B: user address
gnokey maketx run -gas-fee 100000ugnot -gas-wanted 12000000 -broadcast -chainid tendermint_test test1 $WORK/run/barB.gno
stdout ${test1_user_addr}

## 11. MsgRun -> std.PreviousRealm(): user address
gnokey maketx run -gas-fee 100000ugnot -gas-wanted 12000000 -broadcast -chainid tendermint_test test1 $WORK/run/baz.gno
stdout ${test1_user_addr}

-- r/myrlm/myrlm.gno --
package myrlm

import "std"

func A() string {
	return std.OriginPkgAddress().String()
}

func B() string {
	return A()
}
-- r/foo/foo.gno --
package foo

import "gno.land/r/myrlm"

func A() string {
	return myrlm.A()
}

func B() string {
	return myrlm.B()
}
-- p/demo/bar/bar.gno --
package bar

import "std"

func A() string {
	return std.OriginPkgAddress().String()
}

func B() string {
	return A()
}
-- run/myrlmA.gno --
package main

import myrlm "gno.land/r/myrlm"

func main() {
	println(myrlm.A())
}
-- run/myrlmB.gno --
package main

import "gno.land/r/myrlm"

func main() {
	println(myrlm.B())
}
-- run/fooA.gno --
package main

import "gno.land/r/foo"

func main() {
	println(foo.A())
}
-- run/fooB.gno --
package main

import "gno.land/r/foo"

func main() {
	println(foo.B())
}
-- run/barA.gno --
package main

import "gno.land/p/demo/bar"

func main() {
	println(bar.A())
}
-- run/barB.gno --
package main

import "gno.land/p/demo/bar"

func main() {
	println(bar.B())
}
-- run/baz.gno --
package main

import "std"

func main() {
	println(std.OriginPkgAddress().String())
}
