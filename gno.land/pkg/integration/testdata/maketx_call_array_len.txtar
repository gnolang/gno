# Verify that MsgCall rejects [N]byte arguments whose base64-decoded
# length does not match the declared array size.

loadpkg gno.land/r/test/arrlen $WORK/realm

gnoland start

# Correct length (32 bytes) should succeed.
gnokey maketx call -pkgpath gno.land/r/test/arrlen -func CheckLen -args 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=' -gas-fee 1000000ugnot -gas-wanted 2000000 -broadcast -chainid=tendermint_test test1
stdout '("32" string)'

# Oversized input (100 bytes) must be rejected.
! gnokey maketx call -pkgpath gno.land/r/test/arrlen -func CheckLen -args 'AAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJygpKissLS4vMDEyMzQ1Njc4OTo7PD0+P0BBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWltcXV5fYGFiYw==' -gas-fee 1000000ugnot -gas-wanted 2000000 -broadcast -chainid=tendermint_test test1
stderr 'array length mismatch'

# Empty input (0 bytes) must be rejected.
! gnokey maketx call -pkgpath gno.land/r/test/arrlen -func CheckLen -args '' -gas-fee 1000000ugnot -gas-wanted 2000000 -broadcast -chainid=tendermint_test test1
stderr 'array length mismatch'

-- realm/realm.gno --
package arrlen

import "strconv"

func CheckLen(cur realm, data [32]byte) string {
	return strconv.Itoa(len(data))
}
